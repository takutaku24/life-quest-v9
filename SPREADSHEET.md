# Life Quest — スプレッドシート構成

アプリは **列番号（1始まり）** で書き込むため、**users シートは列の並び順を合わせてください。**

---

## 1. シート「users」

| 列 | ヘッダー名（推奨） | 説明 | 必須 |
|----|-------------------|------|------|
| A (1) | user_id | ユーザーID（'u001' で検索） | ✅ |
| B (2) | name | 表示名 | ✅ |
| C (3) | level | レベル | ✅ |
| D (4) | current_xp | 現在の経験値 | ✅ |
| E (5) | next_level_xp | 次のレベルまでに必要な経験値 | ✅ |
| F (6) | gold | 所持金 | ✅ |
| **G (7)** | **rebirth_count** | 転生回数（数値） | 転生を使うなら必須 |
| H (8) | dungeon_floor | 現在の階層（1〜100） | ✅ |
| I (9) | login_streak | ログイン連続日数（任意） | — |
| J (10) | _login または last_login | 最終ログイン日（任意） | — |
| **K (11)** | **job_class** | 職業（Novice / Warrior / Wizard / Engineer / Jester） | ✅ |
| L (12) | pity_counter | ガチャピティカウンター（任意） | — |
| M (13) | last_free_gacha | 最後に無料ガチャを引いた日（YYYY-MM-DD） | ✅ |
| N (14) | daily_claimed | デイリー報酬を受取った日 | ✅ |
| O (15) | weekly_claimed | ウィークリー報酬を受取った週（例: 2025-W7） | ✅ |
| P (16) | boss_damage | ボスダメージ（任意） | — |
| Q (17) | equipped_pet | 装備中の相棒（モンスター名 or 空） | ✅ |
| R (18) | stamp_card | スタンプカード（任意） | — |
| S (19) | weekly_boss_damage | 今週のボスに与えたダメージ合計 | ✅ |
| T (20) | titles | 称号（複数形、任意） | — |
| **U (21)** | **title** | 現在の称号（転生で書き込み） | 転生を使うなら必須 |
| **V (22)** | **last_weekly_ticket** | 週1回チケ10枚セット購入した週（例: 2025-W8） | ショップ限定品用 |
| **W (23)** | **last_monthly_sr_ticket** | 月1回SR確定チケ購入した月（例: 2025-02） | ショップ限定品用 |
| **X (24)** | **buff_data** | バフデータ（任意） | — |
| **Y (25)** | **achievements** | 実績IDのリスト（カンマ区切り、例: "ach_1,ach_2"） | ✅ 報酬システム用 |
| **Z (26)** | **mission_claimed** | ミッションIDのリスト（カンマ区切り、例: "mission_1,mission_2"） | ✅ 報酬システム用 |
| **AA (27)** | **boss_claimed** | ボス討伐報酬の受取週（例: 2025-W7） | ✅ 報酬システム用 |
| **AB (28)** | **streak_protect_date** | ストリーク保護を使用した日（YYYY-MM-DD） | ストリーク保護用 |
| **AC (29)** | **last_rest_week** | 休息日を使った週（例: 2026-W8）週1回まで | ADHD向け休息日用 |
| **AD (30)** | **unlocked_titles** | 解除した限定称号（カンマ区切り、例: streak_7,monthly_50） | 限定称号用 |
| **AE (31)** | **zone_start** | ゾーンタイム開始時刻（ISO形式） | 集中記録用 |
| **AF (32)** | **zone_log** | 集中記録（日付:分,日付:分…） | 集中記録用 |
| **AG (33)** | **task_custom** | タスク表示名のカスタム（JSON） | タスク見た目用 |
| **AH (34)** | **seasonal_claimed** | 季節ミッション受取月（例: 2026-02） | 季節限定ミッション用 |
| **AI (35)** | **outing_start** | 相棒おでかけ開始時刻（ISO形式） | おでかけ報酬用 |

**注意:** 列を追加・削除すると列番号がずれます。G(7) が rebirth_count、U(21) が title になるよう、コード側の列番号と合わせてください。

**⚠️ 重要：報酬の重複受取を防ぐために、以下の列が存在することを確認してください：**
- **Y (25) achievements** - 実績報酬用
- **Z (26) mission_claimed** - ミッション報酬用
- **AA (27) boss_claimed** - ボス討伐報酬用

これらの列が存在しない場合、報酬を何度も受け取れてしまいます。詳細は `SPREADSHEET_CHECKLIST.md` を参照してください。

---

## 2. シート「tasks」

タスク完了時に **1行追加** されます。

| 列 | ヘッダー名（推奨） | 説明 |
|----|-------------------|------|
| A | id | UUID |
| B | user_id | 'u001' |
| C | task_name | タスク名（例: 🏃 偵察任務 (Walk)） |
| D | type | physical / holy / magic / heal |
| E | quantity | 1 |
| F | status | 'Completed' |
| G | created_at | 完了日時（日付でデイリー・ウィークリー集計に使用） |

**1行目はヘッダー** にしてください。

---

## 3. シート「inventory」

ガチャで獲得したモンスターを **1体ずつ1行** で追加します。

| 列 | ヘッダー名（推奨） | 説明 |
|----|-------------------|------|
| A | user_id | 'u001' |
| B | item_name | モンスター名（スライム、ゴブリン など） |
| C | rarity | N / R / UR |
| D | quantity | 1 |
| E | acquired_at | 獲得日時 |

**1行目はヘッダー** にしてください。

---

## 変更・追加のおすすめ

1. **users の T(20)・U(21)**  
   rebirth_count と title/titles を用意すると転生が保存されます（すでに対応済みならそのままでOK）。

2. **ヘッダー名の重複**  
   1行目に同じ名前の列を複数作らないでください（例: rebirth_count を2つ）。重複があるとエラーになります。

3. **列の順序**  
   users だけは「何列目に何を書くか」がコードで固定されているので、**列の並びを変えると書き込み先がずれます**。上表の順序に揃えるか、ずらした場合は app.py の `update_cell(u_idx, 数字, ...)` の数字を合わせてください。

4. **シート名**  
   「users」「tasks」「inventory」の3シートが存在し、名前が一致している必要があります。
